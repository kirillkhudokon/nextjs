import type { Post } from "@/types/posts";
import PostItem from "./PostItem";
import { notFound } from "next/navigation";
import { Image } from "@/types/images";
import Gallery from "@/components/shared/GalleryViewer";

export const dynamic = 'force-dynamic'

export default async function Post({ params } : PageProps<'/posts/[slug]'>){
  const { slug } = await params;
  const response = await fetch(`http://localhost:3001/posts/byurl/${slug}`);

  if(response.status != 200){
    return notFound();
  }

  const post: Post = await response.json();
  const images: Image[] = await (fetch(`http://localhost:3001/images/post/${post.id}`).then(r => r.json()));

  return (
    <div>
      <main>
        <PostItem post={post} />
        <hr/>
        <Gallery images={images} />
      </main>
    </div>
  );
}
